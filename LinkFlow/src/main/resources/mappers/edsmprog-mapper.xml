<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edsmProgMapper">
	
	
	<resultMap type="DeptDto" id="deptResult" extends="commonMapper.commonResult">
		<result column="DEPT_CODE" property="deptCode"/>
		<result column="DEPT_TITLE" property="deptTitle"/>
		
		<collection property="memberList" ofType="MemberDto">
			<id column="USER_ID" property="userId"/>
			<result column="USER_NAME" property="userName"/>
			<result column="sub_name" property="subName"/>
		</collection>

	</resultMap>
	
	<select id="selectApprLine" resultMap="deptResult">
		SELECT 
         D.DEPT_CODE       
       , D.DEPT_TITLE 
       , M.USER_NAME 
       , C.SUB_NAME 
       , M.USER_ID
      FROM 
          TB_MEMBER M
      JOIN 
          TB_DEPT D ON M.DEPT_CODE = D.DEPT_CODE
      LEFT JOIN 
          TB_COMMON C ON M.RANK_BCODE = C.MAIN_CODE AND M.RANK_SCODE = C.SUB_CODE
      JOIN
        TB_COMMON C ON (C.MAIN_CODE = M.RANK_BCODE AND C.SUB_CODE = M.RANK_SCODE)
      WHERE 
          M.DEL_YN = 'N'
      ORDER BY D.DEPT_CODE
	</select>
</mapper>
