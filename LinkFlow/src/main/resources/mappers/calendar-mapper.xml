<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="calendarMapper">
	<resultMap type="calendarDto" id="calendarResult" extends="commonMapper.commonResult">
		<id column="CAL_NO" property="calNo"/>
		<result column="DEPT_CODE" property="deptCode"/>
		<result column="CAL_SUB_CODE" property="calSubCode"/>
		<result column="CAL_COLOR" property="calColor"/>
		<collection property="schedules" ofType="scheduleDto" resultMap="scheduleResult"/>
	</resultMap>
	
	<resultMap type="scheduleDto" id="scheduleResult" extends="commonMapper.commonResult">
     <id column="SCH_NO" property="schNo"/>
     <result column="SCH_CONTENT" property="schContent"/>
     <result column="START_DATE" property="startDate"/>
     <result column="END_DATE" property="endDate"/>
     <result column="ADDRESS" property="address"/>
     <result column="SCH_IMPORT" property="schImport"/>
     <result column="NOTIFY_YN" property="notifyYn"/>
     <result column="SCH_TITLE" property="schTitle"/>
    </resultMap>
						
		
	<!-- 일정등록 -->
	<insert id="insertSch">
	    INSERT INTO TB_SCHEDULE
	    (
	        SCH_NO,
	        CAL_NO, 
	        SCH_CONTENT,
	        START_DATE,
	        END_DATE,
	        ADDRESS,
	        SCH_IMPORT,
	        NOTIFY_YN,
	        REG_DATE,
	        MOD_DATE,
	        MOD_ID,
	        DEL_YN,
	        SCH_TITLE
	    )
	    VALUES
	    (
	        SEQ_SCHNO.nextval,
	        (
	            SELECT CAL_NO
	            FROM TB_CALENDAR
	            WHERE CAL_SUB_CODE = #{schCalSubCode}
	            AND REG_ID = #{modId}
	        ),
	        #{schContent},
	        #{startDate},
	        #{endDate},
	        #{address},
	        #{schImport},
	        #{notifyYn},
	        SYSDATE,
	        SYSDATE,
	        #{modId},
	        'N',
	        #{schTitle}  
	    )
	</insert>

	<!-- 전체일정 조회(특정 캘린더)  -->
	<select id="selectSchList" resultMap="scheduleResult">
     SELECT 
         S.SCH_NO,
         C.CAL_NO,
         S.SCH_CONTENT,
         S.START_DATE,
         S.END_DATE,
         S.ADDRESS,
         S.SCH_IMPORT,
         S.NOTIFY_YN,
         S.SCH_TITLE,
         C.CAL_COLOR
    FROM TB_SCHEDULE S
    JOIN TB_CALENDAR C ON (C.CAL_NO = S.CAL_NO)
    WHERE C.CAL_SUB_CODE = #{schCalSubCode} 
	</select> 
</mapper>